{"id":"agentic-coding-research-1","title":"Build git-merge-agent: Context-aware merge conflict resolution with Claude integration","description":"## Problem Statement\n\nWhen merging worktree branches back to main, git conflicts occur. Current reality:\n- Claude doesn't know what was in each branch\n- Claude doesn't know the intent of each change\n- Manual explanation of conflict context required\n- Resolution happens without full understanding\n\n**No existing system addresses this properly.** This is a genuine innovation opportunity.\n\n## Solution: Context-Aware Merge Conflict Agent\n\nBuild `git-merge-agent` - a tool that provides Claude with rich context for merge conflict resolution.\n\n### Key Innovation\nUnlike any existing tool (Tmux Orchestrator, ephraimduncan/worktrees, etc.), this agent:\n- Understands BOTH branches' intent\n- Knows the bead/feature purpose\n- Can reason about which change wins\n- Resolves automatically when safe\n- Provides interactive resolution for complex cases\n\n## Architecture\n\n### Phase 1: Context Gathering\nWhen conflicts detected:\n1. Read conflict markers in files\n2. Get full file history from both branches\n3. Get bead description for feature branch\n4. Get commit messages for context\n5. Identify conflict type (overlapping edits, moved code, etc.)\n\n### Phase 2: Resolution Strategy\n- If non-overlapping: auto-merge (safe)\n- If overlapping: present options to user\n- If complex: call Claude with full context\n\n### Phase 3: Claude Integration\nBuild rich prompt with:\n- Branch A intent (from commits)\n- Branch B intent (from bead + commits)\n- Full conflicting sections (not just markers)\n- Commit history for evolution context\n- Reasoning framework\n\n### Phase 4: User Review\n- Show Claude's recommendation\n- Accept/Edit/Reject options\n- Apply resolution\n\n## Implementation Plan\n\n### Version 1: Context Builder (2-3 hours)\n**Goal:** Build rich context, open editor with context file\n\n**Script:** `tools/git-merge-agent` (~50 lines bash)\n\n**Features:**\n- Detect conflicts on merge\n- Extract: bead description, commit history, conflicted files\n- Generate context markdown file\n- Open editor with context\n\n**Usage:**\n```bash\ngit-merge-agent feature-branch-name\n```\n\n**Output:** `/tmp/merge-context.md` with:\n- Branch names\n- Bead description\n- Conflicted files list\n- Recent commits (both branches)\n- Resolution instructions\n\n### Version 2: Claude Integration (4-6 hours)\n**Goal:** Interactive Claude session for conflict resolution\n\n**Enhancements:**\n- Spawn temporary tmux session: `merge-conflict-{branch}`\n- Set BEADS_NO_DAEMON=1 automatically\n- Send rich context prompt to Claude\n- Iterate through each conflicted file\n- Accept/edit/reject Claude's suggestions\n- Cleanup session after resolution\n\n**Usage:**\n```bash\ngit-merge-agent feature-branch-name --interactive\n```\n\n### Version 3: Auto-Resolution (future)\n**Goal:** Automatically resolve safe conflicts\n\n**Features:**\n- Detect non-overlapping changes\n- Auto-merge when both changes are compatible\n- Only escalate complex conflicts to user\n- Learning from past resolutions\n\n## Technical Specifications\n\n### Script Location\n`~/agentic-coding-research/tools/git-merge-agent`\n\n### Dependencies\n- git (conflict detection, history)\n- bd (bead context retrieval)\n- tmux (v2 - interactive session)\n- claude CLI (v2 - Claude integration)\n- BEADS_NO_DAEMON=1 (worktree compatibility)\n\n### Integration Points\n- Works with existing `/worktree-*` commands\n- Uses BEADS_NO_DAEMON=1 automatically\n- Integrates with beads for feature intent\n- Can be called from `wt merge` command (future)\n\n### Error Handling\n- Graceful fallback if no bead exists\n- Handle missing commit history\n- Timeout for Claude responses\n- User can abort at any stage\n\n## Testing Plan\n\n### Manual Testing Scenarios\n1. **Simple conflict** - Non-overlapping edits in same file\n2. **Complex conflict** - Overlapping function changes\n3. **Multiple files** - Conflicts in 3+ files\n4. **No bead** - Feature branch without associated bead\n5. **Large conflict** - 100+ line section conflicts\n\n### Success Criteria\n- Context file contains all relevant information\n- User can resolve conflicts faster with context\n- Claude recommendations are helpful (v2)\n- No data loss during resolution\n- Works correctly with BEADS_NO_DAEMON=1\n\n## Documentation\n\n### README Section\nAdd to tools/README.md:\n- What git-merge-agent does\n- When to use it\n- Usage examples\n- Comparison to manual resolution\n\n### Blog Post Potential\n\"Building a Context-Aware Git Merge Conflict Agent with Claude\"\n- Problem statement (nobody solves this)\n- Architecture walkthrough\n- Real examples\n- Results comparison\n\n## Success Metrics\n\n### Quantitative\n- Time to resolve conflicts (before vs after)\n- Number of back-and-forth iterations reduced\n- Conflicts resolved correctly on first attempt\n\n### Qualitative\n- User confidence in resolution\n- Understanding of both branches' intent\n- Reduced mental overhead\n\n## Future Enhancements\n\n### v3: Pattern Learning\n- Remember similar conflicts\n- Suggest resolution based on past decisions\n- Build conflict resolution knowledge base\n\n### v4: Multi-Agent Coordination\n- Feature branch agent explains its changes\n- Main branch agent explains baseline\n- Coordinator agent mediates resolution\n\n### v5: Proactive Conflict Detection\n- Pre-merge analysis\n- Warn about potential conflicts\n- Suggest refactoring to avoid conflicts\n\n## References\n\n- Beads issue #170: BEADS_NO_DAEMON=1 for worktrees\n- Tmux Orchestrator: Multi-agent patterns (doesn't solve merge conflicts)\n- ephraimduncan/worktrees: TUI for worktrees (doesn't solve merge conflicts)\n\n## Related Work\n\n**Existing gap:** No tool provides context-aware merge conflict resolution with AI\n\n**Innovation:** Combining bead context + commit history + Claude reasoning\n\n**Unique approach:** Interactive resolution vs one-shot suggestions\n\n## Timeline\n\n- **Version 1:** 2-3 hours (context builder)\n- **Testing v1:** 1-2 days on real projects\n- **Version 2:** 4-6 hours (Claude integration)\n- **Testing v2:** 1-2 weeks organic usage\n- **Blog post:** After v2 proves valuable\n\n**Total estimated:** 1 week to production-ready v2","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T16:46:03.097033+05:30","updated_at":"2025-11-06T16:47:43.320044+05:30"}
{"id":"agentic-coding-research-2","title":"Build wt TUI: Interactive dashboard for worktree session management","description":"## Problem Statement\n\n**Current pain:** Alt+Tab between terminal windows is clunky for managing multiple worktree sessions.\n\n**Need:** Fast, visual snapshot of all sessions with status (running/idle) and ability to jump into any session quickly.\n\n**Key insight:** Parallel worktrees are rare. Primary use case is **sequential switching** with visual overview, not coordination.\n\n## Solution: Minimal TUI Dashboard\n\nBuild `wt` - a terminal UI dashboard for worktree session management.\n\n**Philosophy:** Start small, functional, iterate based on real usage. Ship this week.\n\n### Core Features (MVP)\n\n1. **Visual snapshot** - See all worktrees + sessions at a glance\n2. **Status indicators** - Running/Idle/Error visual cues\n3. **Quick jump** - Press Enter to attach to session\n4. **Keyboard shortcuts** - Fast navigation, no mouse needed\n5. **Human-in-loop merge** - Only call git-merge-agent if conflicts detected\n\n### Non-Goals (for MVP)\n\n- ❌ Multi-agent coordination (rare use case)\n- ❌ Command broadcasting (can add later if needed)\n- ❌ Real-time monitoring (static snapshot is sufficient)\n- ❌ Complex orchestration (YAGNI)\n\n## UI Design (Minimal)\n\n```\n┌─ Worktree Sessions ─────────────────────────────┐\n│                                                  │\n│  [1] ● feature-auth        Running    3↑ main   │\n│  [2] ○ feature-billing     Idle       1↑ main   │\n│  [3] ✗ redis-cache         Error      2↑ main   │\n│  [4]   main                -          -          │\n│                                                  │\n└──────────────────────────────────────────────────┘\n\n● = Claude working  ○ = Session idle  ✗ = Error  - = No session\n\n[1-9] Select | [Enter] Attach | [r] Refresh | [q] Quit\n\nPath: ~/project-worktrees/feature-auth\nLast: bd stats (2m ago)\n```\n\n**That's it.** Simple, functional, does the job.\n\n### Keyboard Shortcuts\n\n| Key | Action | Notes |\n|-----|--------|-------|\n| `1-9` | Select worktree | Highlight row |\n| `Enter` | Attach to session | `tmux attach -t wt-\u003cname\u003e` |\n| `j/k` | Navigate down/up | Vim-style |\n| `↑/↓` | Navigate | Arrow keys |\n| `r` | Refresh | Re-poll tmux/git |\n| `q/Esc` | Quit | Exit to shell |\n\n**Future shortcuts (if needed):**\n- `c`: Create new worktree\n- `d`: Delete worktree\n- `m`: Merge (calls git-merge-agent if conflicts)\n- `s`: Send command to session\n\n## Implementation Plan\n\n### Technology Choice: `gum` (Charm's tool)\n\n**Why gum:**\n- ✅ Single binary (easy install: `brew install gum`)\n- ✅ Composable with bash (no framework needed)\n- ✅ Beautiful TUI components out of the box\n- ✅ Fast to build (~2 hours vs 2 days for custom TUI)\n- ✅ Maintained by Charm (reliable)\n\n**Alternative considered:** `bubbletea` (Go), `textual` (Python), `ratatui` (Rust)\n**Rejected because:** Overkill for MVP, longer dev time, you need to ship THIS WEEK\n\n### MVP Implementation (~2-3 hours)\n\n**Script:** `~/agentic-coding-research/tools/wt`\n\n**Pseudocode:**\n```bash\n#!/bin/bash\n# wt - Worktree session TUI\n\n# 1. Gather data\nworktrees=$(git worktree list)\nsessions=$(tmux list-sessions | grep \"^wt-\")\n\n# 2. Build status for each worktree\nfor wt in $worktrees; do\n  # Check if session exists\n  # Check Claude status (running/idle/error)\n  # Check git status (ahead/behind)\n  # Format row: \"[N] ● name  Running  3↑\"\ndone\n\n# 3. Show interactive menu with gum\nselected=$(echo \"$rows\" | gum choose --header=\"Worktree Sessions\")\n\n# 4. Attach to selected session\nsession_name=$(extract_session_from_row \"$selected\")\ntmux attach -t \"$session_name\"\n```\n\n**Status Detection:**\n```bash\n# Detect Claude status from last tmux output\nlast_output=$(tmux capture-pane -t \"$session\" -p | tail -10)\n\nif echo \"$last_output\" | grep -q \"\\[Using tool:\"; then\n  status=\"● Running\"\nelif echo \"$last_output\" | grep -q \"\u003e \"; then\n  status=\"○ Idle\"\nelif echo \"$last_output\" | grep -iq \"error\"; then\n  status=\"✗ Error\"\nelse\n  status=\"- No session\"\nfi\n```\n\n### Enhanced Version (if MVP proves useful)\n\n**Add later based on actual usage:**\n- Real-time refresh (every 5s)\n- Preview pane (show last 10 lines)\n- Multi-select for batch operations\n- Integration with `/worktree-new`, `/worktree-delete`\n\n## Technical Specifications\n\n### Script Location\n`~/agentic-coding-research/tools/wt`\n\n### Dependencies\n- `gum` (install: `brew install gum`)\n- `tmux` (already using)\n- `git` (already using)\n- `bd` (optional, for bead info)\n\n### Integration with Existing Tools\n\n**Calls existing commands:**\n- Uses same session naming: `wt-\u003cfeature-name\u003e`\n- Compatible with `/worktree-new` (spawns sessions)\n- Compatible with `/worktree-status` (similar data)\n- Can call `git-merge-agent` when conflicts detected\n\n**Human-in-loop merge:**\n```bash\n# In wt script, add 'm' for merge\nif [ \"$key\" = \"m\" ]; then\n  branch=$(extract_branch_from_worktree \"$selected\")\n\n  # Attempt merge\n  git merge \"$branch\"\n\n  # If conflicts detected\n  if [ $? -ne 0 ]; then\n    echo \"Conflicts detected. Calling git-merge-agent...\"\n    git-merge-agent \"$branch\"\n  else\n    echo \"Merge successful, no conflicts!\"\n  fi\nfi\n```\n\n## Testing Plan\n\n### Quick Tests (30 minutes)\n\n1. **No sessions** - Show worktrees without active sessions\n2. **All sessions active** - Show all with status\n3. **Mixed state** - Some active, some idle, some errors\n4. **Attach works** - Press Enter, successfully attaches\n5. **Keyboard nav** - j/k and arrows work\n\n### Real Usage Test (1-2 days)\n\nUse `wt` for actual worktree switching during daily work.\n\n**Capture patterns:**\n```bash\nclaude-pattern \"wt TUI reduced context switching by X seconds\"\nclaude-pattern \"Status indicators help identify stuck sessions\"\nclaude-pattern \"Need preview pane to see what Claude is doing\"\n```\n\n## Success Criteria\n\n### MVP Success (This Week)\n\n- ✅ Can see all worktrees at a glance\n- ✅ Can identify session status (running/idle/error)\n- ✅ Can jump into any session with 2 keypresses\n- ✅ Faster than alt+tab between terminals\n- ✅ Takes \u003c3 hours to build\n- ✅ Works reliably\n\n### Long-term Success (After Usage)\n\n- Used daily (replaces alt+tab completely)\n- Clear pain points identified for v2\n- Patterns captured in organic research\n- Worth enhancing vs. sticking with `/worktree-*`\n\n## Timeline\n\n**Thursday (today):**\n- 2-3 hours: Build MVP with gum\n- 30 min: Test basic functionality\n\n**Friday-Next Week:**\n- Use it daily on real work\n- Capture patterns\n- Identify what's missing\n\n**After 1 week of usage:**\n- Decide: Enhance, Keep as-is, or Abandon\n- If enhance: Add preview pane, real-time refresh\n- If keep: Done, move on\n- If abandon: Revert to alt+tab, no harm done\n\n## Installation\n\n```bash\n# Install gum\nbrew install gum\n\n# Make wt executable\nchmod +x ~/agentic-coding-research/tools/wt\n\n# Add to PATH (already done via install.sh)\n```\n\n## Usage Examples\n\n### Basic Usage\n```bash\n# Launch TUI\nwt\n\n# Select with number keys (1-9)\n# Or navigate with j/k\n# Press Enter to attach\n```\n\n### Future Enhancements (Based on Usage)\n```bash\n# With merge support\nwt m  # Merge current worktree (calls git-merge-agent if conflicts)\n\n# With command send\nwt send \"bd stats\"  # Send to all active sessions\n\n# With create/delete\nwt c  # Create new worktree (calls /worktree-new)\nwt d  # Delete selected worktree (calls /worktree-delete)\n```\n\n## Key Design Decisions\n\n### 1. Why TUI not CLI?\n\n**CLI** (`wt list`, `wt attach feature-a`):\n- ❌ Still need to remember names\n- ❌ No visual status overview\n- ❌ More typing\n\n**TUI** (interactive dashboard):\n- ✅ See everything at once\n- ✅ Visual status indicators\n- ✅ Muscle memory (number keys)\n\n### 2. Why gum not custom TUI framework?\n\n**Custom framework** (bubbletea, textual):\n- ❌ 2-3 days to build\n- ❌ More code to maintain\n- ❌ Overkill for MVP\n\n**gum** (composable CLI):\n- ✅ 2-3 hours to build\n- ✅ Minimal code\n- ✅ Good enough for MVP\n- ✅ Can always rewrite later if needed\n\n### 3. Why minimal not comprehensive?\n\n**You need to ship this week.**\n\nStart with:\n- ✅ Snapshot view\n- ✅ Status indicators\n- ✅ Quick attach\n\nAdd later (if actually needed):\n- Preview pane\n- Real-time updates\n- Advanced features\n\n**Iterate based on real usage, not speculation.**\n\n## Parallel Worktrees Reality Check\n\n**Your insight:** \"Parallel worktrees are very rare IMO\"\n\n**Agreed.** This validates the minimal approach.\n\n**Primary use case:** Sequential switching\n- Work on feature-a\n- Check feature-b status\n- Jump to feature-c\n- Back to feature-a\n\n**NOT:** Coordinating 5 agents working simultaneously\n\n**This means:**\n- Static snapshot is sufficient\n- No need for real-time monitoring\n- No need for complex orchestration\n- Simple TUI is perfect\n\n## Open Questions (Decide During Build)\n\n1. **Should status auto-refresh?**\n   - Option A: Static (press 'r' to refresh)\n   - Option B: Auto-refresh every 5s\n   - **Recommendation:** Start with A, add B if annoying\n\n2. **Show bead info in list?**\n   - Option A: Just worktree name\n   - Option B: Include bead title\n   - **Recommendation:** Start with A, add B if useful\n\n3. **Preview pane?**\n   - Option A: No preview (minimal)\n   - Option B: Show last 5 lines of session\n   - **Recommendation:** Start with A, add B if missing it\n\n## Documentation\n\n### README Update\n\nAdd to `tools/README.md`:\n\n```markdown\n### `wt` - Worktree Session TUI\n\nInteractive dashboard for managing worktree sessions.\n\n**Usage:**\n```bash\nwt  # Launch interactive TUI\n```\n\n**Keyboard shortcuts:**\n- `1-9`: Select worktree\n- `Enter`: Attach to session\n- `j/k`: Navigate\n- `r`: Refresh\n- `q`: Quit\n\n**Status indicators:**\n- `●` Running (Claude actively working)\n- `○` Idle (Session waiting for input)\n- `✗` Error (Error detected in session)\n- `-` No session\n\n**Requirements:**\n- `gum` (install: `brew install gum`)\n```\n\n## Risk Mitigation\n\n**Risk:** gum might not be flexible enough\n\n**Mitigation:** If limitations hit after 1 week, can rewrite with bubbletea. Cost: 1 day. But probably won't need to.\n\n**Risk:** Takes longer than 3 hours\n\n**Mitigation:** Cut scope further. Start with just: list + attach. No status detection.\n\n**Risk:** Not actually useful in practice\n\n**Mitigation:** That's fine! Only spent 3 hours. Learned something. Move on. This is organic research.\n\n## Success = Useful This Week\n\nIf by Sunday you've used `wt` more than 5 times → Success!\n\nIf not → Also success (learned it's not needed).\n\nEither way, you ship your real work and have data for next iteration.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-06T16:53:21.971316+05:30","updated_at":"2025-11-06T16:54:39.39314+05:30"}
