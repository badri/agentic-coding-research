{"id":"agentic-coding-research-1","title":"Build git-merge-agent: Context-aware merge conflict resolution with Claude integration","description":"## Problem Statement\n\nWhen merging worktree branches back to main, git conflicts occur. Current reality:\n- Claude doesn't know what was in each branch\n- Claude doesn't know the intent of each change\n- Manual explanation of conflict context required\n- Resolution happens without full understanding\n\n**No existing system addresses this properly.** This is a genuine innovation opportunity.\n\n## Solution: Context-Aware Merge Conflict Agent\n\nBuild `git-merge-agent` - a tool that provides Claude with rich context for merge conflict resolution.\n\n### Key Innovation\nUnlike any existing tool (Tmux Orchestrator, ephraimduncan/worktrees, etc.), this agent:\n- Understands BOTH branches' intent\n- Knows the bead/feature purpose\n- Can reason about which change wins\n- Resolves automatically when safe\n- Provides interactive resolution for complex cases\n\n## Architecture\n\n### Phase 1: Context Gathering\nWhen conflicts detected:\n1. Read conflict markers in files\n2. Get full file history from both branches\n3. Get bead description for feature branch\n4. Get commit messages for context\n5. Identify conflict type (overlapping edits, moved code, etc.)\n\n### Phase 2: Resolution Strategy\n- If non-overlapping: auto-merge (safe)\n- If overlapping: present options to user\n- If complex: call Claude with full context\n\n### Phase 3: Claude Integration\nBuild rich prompt with:\n- Branch A intent (from commits)\n- Branch B intent (from bead + commits)\n- Full conflicting sections (not just markers)\n- Commit history for evolution context\n- Reasoning framework\n\n### Phase 4: User Review\n- Show Claude's recommendation\n- Accept/Edit/Reject options\n- Apply resolution\n\n## Implementation Plan\n\n### Version 1: Context Builder (2-3 hours)\n**Goal:** Build rich context, open editor with context file\n\n**Script:** `tools/git-merge-agent` (~50 lines bash)\n\n**Features:**\n- Detect conflicts on merge\n- Extract: bead description, commit history, conflicted files\n- Generate context markdown file\n- Open editor with context\n\n**Usage:**\n```bash\ngit-merge-agent feature-branch-name\n```\n\n**Output:** `/tmp/merge-context.md` with:\n- Branch names\n- Bead description\n- Conflicted files list\n- Recent commits (both branches)\n- Resolution instructions\n\n### Version 2: Claude Integration (4-6 hours)\n**Goal:** Interactive Claude session for conflict resolution\n\n**Enhancements:**\n- Spawn temporary tmux session: `merge-conflict-{branch}`\n- Set BEADS_NO_DAEMON=1 automatically\n- Send rich context prompt to Claude\n- Iterate through each conflicted file\n- Accept/edit/reject Claude's suggestions\n- Cleanup session after resolution\n\n**Usage:**\n```bash\ngit-merge-agent feature-branch-name --interactive\n```\n\n### Version 3: Auto-Resolution (future)\n**Goal:** Automatically resolve safe conflicts\n\n**Features:**\n- Detect non-overlapping changes\n- Auto-merge when both changes are compatible\n- Only escalate complex conflicts to user\n- Learning from past resolutions\n\n## Technical Specifications\n\n### Script Location\n`~/agentic-coding-research/tools/git-merge-agent`\n\n### Dependencies\n- git (conflict detection, history)\n- bd (bead context retrieval)\n- tmux (v2 - interactive session)\n- claude CLI (v2 - Claude integration)\n- BEADS_NO_DAEMON=1 (worktree compatibility)\n\n### Integration Points\n- Works with existing `/worktree-*` commands\n- Uses BEADS_NO_DAEMON=1 automatically\n- Integrates with beads for feature intent\n- Can be called from `wt merge` command (future)\n\n### Error Handling\n- Graceful fallback if no bead exists\n- Handle missing commit history\n- Timeout for Claude responses\n- User can abort at any stage\n\n## Testing Plan\n\n### Manual Testing Scenarios\n1. **Simple conflict** - Non-overlapping edits in same file\n2. **Complex conflict** - Overlapping function changes\n3. **Multiple files** - Conflicts in 3+ files\n4. **No bead** - Feature branch without associated bead\n5. **Large conflict** - 100+ line section conflicts\n\n### Success Criteria\n- Context file contains all relevant information\n- User can resolve conflicts faster with context\n- Claude recommendations are helpful (v2)\n- No data loss during resolution\n- Works correctly with BEADS_NO_DAEMON=1\n\n## Documentation\n\n### README Section\nAdd to tools/README.md:\n- What git-merge-agent does\n- When to use it\n- Usage examples\n- Comparison to manual resolution\n\n### Blog Post Potential\n\"Building a Context-Aware Git Merge Conflict Agent with Claude\"\n- Problem statement (nobody solves this)\n- Architecture walkthrough\n- Real examples\n- Results comparison\n\n## Success Metrics\n\n### Quantitative\n- Time to resolve conflicts (before vs after)\n- Number of back-and-forth iterations reduced\n- Conflicts resolved correctly on first attempt\n\n### Qualitative\n- User confidence in resolution\n- Understanding of both branches' intent\n- Reduced mental overhead\n\n## Future Enhancements\n\n### v3: Pattern Learning\n- Remember similar conflicts\n- Suggest resolution based on past decisions\n- Build conflict resolution knowledge base\n\n### v4: Multi-Agent Coordination\n- Feature branch agent explains its changes\n- Main branch agent explains baseline\n- Coordinator agent mediates resolution\n\n### v5: Proactive Conflict Detection\n- Pre-merge analysis\n- Warn about potential conflicts\n- Suggest refactoring to avoid conflicts\n\n## References\n\n- Beads issue #170: BEADS_NO_DAEMON=1 for worktrees\n- Tmux Orchestrator: Multi-agent patterns (doesn't solve merge conflicts)\n- ephraimduncan/worktrees: TUI for worktrees (doesn't solve merge conflicts)\n\n## Related Work\n\n**Existing gap:** No tool provides context-aware merge conflict resolution with AI\n\n**Innovation:** Combining bead context + commit history + Claude reasoning\n\n**Unique approach:** Interactive resolution vs one-shot suggestions\n\n## Timeline\n\n- **Version 1:** 2-3 hours (context builder)\n- **Testing v1:** 1-2 days on real projects\n- **Version 2:** 4-6 hours (Claude integration)\n- **Testing v2:** 1-2 weeks organic usage\n- **Blog post:** After v2 proves valuable\n\n**Total estimated:** 1 week to production-ready v2","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T16:46:03.097033+05:30","updated_at":"2025-11-06T16:47:43.320044+05:30"}
